"use strict";let e;Object.defineProperty(exports,"__esModule",{value:!0});var t,n=require("path"),r=require("os"),i=require("child_process"),o=require("stream"),s=require("http"),l=require("net"),u=require("zlib"),a=require("util"),c=require("fs"),d={exports:{}};Object.defineProperty(d.exports,"__esModule",{value:!0});const{round:f,floor:p,max:h}=Math,m=e=>{let[,t]=/([a-f\d]{3,6})/i.exec(e)||[],n=t?t.length:0;if(3===n)t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];else if(6!==n)return[0,0,0];let r=parseInt(t,16);return[r>>16&255,r>>8&255,255&r]},g=(e,t,n)=>e===t&&t===n?e<8?16:e>248?231:f((e-8)/247*24)+232:16+36*f(e/51)+6*f(t/51)+f(n/51),y=e=>{let t,n,r,i,o,s;return e<8?30+e:e<16?e-8+90:(e>=232?t=n=r=(10*(e-232)+8)/255:(s=(e-=16)%36,t=p(e/36)/5,n=p(s/6)/5,r=s%6/5),0==(i=2*h(t,n,r))?30:(o=30+(f(r)<<2|f(n)<<1|f(t)),2===i?o+60:o))},w=(e,t,n)=>y(g(e,t,n)),S=(e=>{let t=e=>!!u.find(t=>e.test(t)),n=globalThis,r=n.Deno,i=null!=r,o=n.process||r||{},s=o.stdout,l="win32"===(i?r.build.os:o.platform),u=o.argv||o.args||[],a=o.env||{},c=-1;if(i)try{a=a.toObject()}catch(e){c=0}let d="FORCE_COLOR",f=a[d],p=parseInt(f),h="false"===f?0:isNaN(p)?3:p,m="NO_COLOR"in a||0===h||t(/^-{1,2}(no-color|color=(false|never))$/),g=d in a&&h||t(/^-{1,2}color=?(true|always)?$/),y=(a.NEXT_RUNTIME||"").indexOf("edge")>-1||"PM2_HOME"in a&&"pm_id"in a||(i?r.isatty(1):s&&"isTTY"in s);return m?0:(c<0&&(c=((e,t,n)=>{let{TERM:r,COLORTERM:i}=e;return"TF_BUILD"in e?1:"TEAMCITY_VERSION"in e?2:"CI"in e?["GITHUB_ACTIONS","GITEA_ACTIONS"].some(t=>t in e)?3:1:!t||/-mono|dumb/i.test(r)?0:n||"truecolor"===i||"24bit"===i||"xterm-kitty"===r?3:/-256(colou?r)?$/i.test(r)?2:/^screen|^tmux|^xterm|^vt[1-5][0-9]([0-9])?|^ansi|color|cygwin|linux|mintty|rxvt/i.test(r)?1:3})(a,y,l)),g&&0===c?3:c)})(),z=S>0,b={open:"",close:""},x=z?(e,t)=>({open:`[${e}m`,close:`[${t}m`}):()=>b,_=e=>(t,n,r)=>e(g(t,n,r)),O=e=>t=>{let[n,r,i]=m(t);return e(n,r,i)};let v=e=>x(`38;5;${e}`,39),M=e=>x(`48;5;${e}`,49),k=(e,t,n)=>x(`38;2;${e};${t};${n}`,39),$=(e,t,n)=>x(`48;2;${e};${t};${n}`,49);1===S?(v=e=>x(y(e),39),M=e=>x(y(e)+10,49),k=(e,t,n)=>x(w(e,t,n),39),$=(e,t,n)=>x(w(e,t,n)+10,49)):2===S&&(k=_(v),$=_(M));let E,C,j={ansi256:v,bgAnsi256:M,fg:v,bg:M,rgb:k,bgRgb:$,hex:O(k),bgHex:O($),visible:b,reset:x(0,0),inverse:x(7,27),hidden:x(8,28),bold:x(1,22),dim:x(2,22),italic:x(3,23),underline:x(4,24),strikethrough:x(9,29),strike:x(9,29),grey:x(90,39),gray:x(90,39),bgGrey:x(100,49),bgGray:x(100,49)},I="Bright",P=30;for(E of["black","red","green","yellow","blue","magenta","cyan","white"])C="bg"+E[0].toUpperCase()+E.slice(1),j[E]=x(P,39),j[E+I]=x(P+60,39),j[C]=x(P+10,49),j[C+I]=x(P+70,49),P++;const{defineProperty:B,defineProperties:A,setPrototypeOf:N}=Object,R=/[Â›][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,T=/(\r?\n)/g,D={},L=({_p:t},{open:n,close:r})=>{let i=(e,...t)=>{if(!e)return"";let n=i._p,{_a:r,_b:o}=n,s=null!=e.raw?String.raw(e,...t):""+e;if(s.includes("\x1b"))for(;null!=n;){let e=n.close,t=e.length;if(t){let r,i=0,o="";for(;~(r=s.indexOf(e,i));)o+=s.slice(i,r)+n.open,i=r+t;i&&(s=o+s.slice(i))}n=n._p}return s.includes("\n")&&(s=s.replace(T,o+"$1"+r)),r+s+o},o=n,s=r;return null!=t&&(o=t._a+n,s=r+t._b),N(i,e),i._p={open:n,close:r,_a:o,_b:s,_p:t},i.open=o,i.close=s,i},F=function(){let t=e=>""+e;return t.isSupported=()=>z,t.strip=e=>e.replace(R,""),t.extend=n=>{for(let e in n){let t=n[e],r=typeof t,i="string"===r?k(...m(t)):t;D[e]="function"===r?{get(){return(...e)=>L(this,t(...e))}}:{get(){let t=L(this,i);return B(this,e,{value:t}),t}}}N(t,e=A({},D))},t.extend(j),t},q=new F;d.exports=q,d.exports.Ansis=F;var U=(t=d.exports)&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;const W=c.promises,G=new TextEncoder,J=a.promisify(u.gzip),H={level:u.constants.Z_DEFAULT_LEVEL},K=Z(n.join(__dirname,"client")),Y=Z(n.join(K,"assets"));function Z(e){return/^\\\\\?\\/.test(e)?e:e.replace(/\\/g,"/")}function V(e){return"string"==typeof e?G.encode(e):e}async function X(e){let t=await Promise.all((await W.readdir(e)).map(t=>n.join(e,t))),r=0,i=[];for(;r!==t.length;){let e=t[r],o=await W.stat(e);if(o.isDirectory()){let r=await W.readdir(e);t.push(...r.map(t=>n.join(e,t)))}o.isFile()&&i.push(e),r++}return i}const Q=process.env.DEBUG||process.env.ANALYZE_DEBUG?(...e)=>{console.log(U.hex("#5B45DE")("[vite:bundle-analyzer]"),...e)}:()=>{};function ee(e){let t="head"===e.injectTo?/([ \t]*)<\/head>/i:/([ \t]*)<\/body>/i;e.descriptors=Array.isArray(e.descriptors)?e.descriptors:[e.descriptors];let n=e.descriptors.map(e=>e.attrs&&e.attrs.length>0?`<${e.kind} ${e.attrs.join(" ")}>${e.text}</${e.kind}>`:`<${e.kind}>${e.text}</${e.kind}>`);return e.html.replace(t,e=>`${n.join("\n")}${e}`)}async function et(e,t){let r=await X(Y),i=(await Promise.all(r.map(async e=>({fileType:n.extname(e).replace(".",""),content:await W.readFile(e,"utf8")})))).filter(e=>["js","css"].includes(e.fileType)),o=await W.readFile(n.join(K,"index.html"),"utf8");return o=ee({html:o=(o=(o=o.replace(/<script\b[^>]*>[\s\S]*?<\/script>/gi,"")).replace(/<link\b[^>]*rel="stylesheet"[^>]*>/gi,"")).replace(/<title>(.*?)<\/title>/,`<title>${t.title}</title>`),injectTo:"head",descriptors:i.map(({fileType:e,content:t})=>({kind:"js"===e?"script":"style",text:t,attrs:"js"===e?['type="module"']:[]}))}),o=ee({html:o,injectTo:"body",descriptors:{kind:"script",text:function(e,t){let{stringify:n}=JSON;return`var defaultSizes=${n(t)},analyzeModule=${n(e)};`}(e,t.mode)}})}async function en(e){let t=()=>Math.floor(64512*Math.random())+1024,n=async e=>new Promise(t=>{let n=l.createServer();n.once("error",e=>{"EADDRINUSE"===e.code?t(!1):t(!0)}),n.once("listening",()=>{n.close(()=>{t(!0)})}),n.listen(e,"localhost")});if(0===e){let e=!1,r=0;for(;!e;)r=t(),e=await n(r);return r}let r=await n(e);if(r)return e;{let t=e+1;for(;;){if(r=await n(t))return t;t++}}}async function er(e=0){let t=s.createServer(),n=await en(e);return t.listen(n,()=>{console.log("server run on ",U.hex("#5B45DE")(`http://localhost:${n}`))}),{setup:e=>{t.on("request",function(t,n){"/"===t.url&&(n.setHeader("Content-Type","text/html; charset=utf8;"),n.setHeader("Content-Encoding","gzip"),e.arena.rs.pipe(u.createGzip()).pipe(n),e.arena.refresh())})},get port(){return n}}}const ei=["pnpm-workspace.yaml","lerna.json"];function eo(e,t=function e(t,r=t){if(function(e){let t=n.join(e,"package.json");return c.existsSync(t)}(t))return t;let i=n.dirname(t);return i&&i!==t?e(i,r):r}(e)){if(ei.some(t=>c.existsSync(n.join(e,t)))||function(e){let t=n.join(e,"package.json");if(!function(e){if(!function(e){try{return c.statSync(e,{throwIfNoEntry:!1})}catch{}}(e))return!1;try{return c.accessSync(e,c.constants.R_OK),!0}catch{return!1}}(t))return!1;try{return!!(JSON.parse(c.readFileSync(t,"utf-8"))||{}).workspaces}catch{return!1}}(e))return e;let r=n.dirname(e);return r&&r!==e?eo(r,t):t}class es{kind;meta;filename;children;groups;isEndOfPath;constructor(e){this.kind=e?.kind||"stat",this.meta=e?.meta||{},this.filename=e?.filename||"",this.children=new Map,this.groups=[],this.isEndOfPath=!1}}class el{root;constructor(e){this.root=new es(e)}insert(e,t){let n=this.root,r=e.split("/").filter(Boolean),i="";for(let e of r)i=i?`${i}/${e}`:e,n.children.has(e)||n.children.set(e,new es({...t})),(n=n.children.get(e)).filename=i;n.isEndOfPath=!0}mergePrefixSingleDirectory(e=this.root){for(let[t,n]of e.children.entries()){if(n.isEndOfPath)break;if(n.children.size>1){this.mergePrefixSingleDirectory(n);continue}for(let[r,i]of(e.children.delete(t),n.children.entries()))e.children.set(`${t}/${r}`,i),i.isEndOfPath||this.mergePrefixSingleDirectory(i)}}walk(e,t){if(e.children.size){for(let[n,r]of e.children.entries()){let i={...r.meta,label:n,groups:r.groups,filename:r.filename};if(r.isEndOfPath&&delete i.groups,t(i,e),this.walk(r,t),i.groups&&i.groups.length)switch(e.kind){case"stat":i.statSize=i.groups.reduce((e,t)=>e+t.statSize,0);break;case"source":{let e=i.groups.reduce((e,t)=>(e.parsedSize+=t.parsedSize,e.gzipSize+=t.gzipSize,e),{parsedSize:0,gzipSize:0});Object.assign(i,e)}}}e.children.clear()}}}const eu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ea=new Uint8Array(64),ec=new Uint8Array(128);for(let e=0;e<eu.length;e++){let t=eu.charCodeAt(e);ea[e]=t,ec[t]=e}const ed="undefined"!=typeof TextDecoder?new TextDecoder:"undefined"!=typeof Buffer?{decode:e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString()}:{decode(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}};function ef(e,t,n,r){let i=0,o=0,s=0;do i|=(31&(s=ec[e.charCodeAt(t++)]))<<o,o+=5;while(32&s);let l=1&i;return i>>>=1,l&&(i=-2147483648|-i),n[r]+=i,t}function ep(e,t,n){return!(t>=n)&&44!==e.charCodeAt(t)}function eh(e,t){return e[0]-t[0]}function em(e,t,n,r,i){let o=r[i],s=o-n[i];n[i]=o,s=s<0?-s<<1|1:s<<1;do{let n=31&s;(s>>>=5)>0&&(n|=32),e[t++]=ea[n]}while(s>0);return t}const eg=/^[\w+.-]+:\/\//,ey=/^([\w+.-]+:)\/\/([^@/#?]*@)?([^:/#?]*)(:\d+)?(\/[^#?]*)?(\?[^#]*)?(#.*)?/,ew=/^file:(?:\/\/((?![a-z]:)[^/#?]*)?)?(\/?[^#?]*)(\?[^#]*)?(#.*)?/i;function eS(e){return e.startsWith("/")}function ez(e){return/^[.?#]/.test(e)}function eb(e){let t=ey.exec(e);return ex(t[1],t[2]||"",t[3],t[4]||"",t[5]||"/",t[6]||"",t[7]||"")}function ex(e,t,n,r,i,o,s){return{scheme:e,user:t,host:n,port:r,path:i,query:o,hash:s,type:7}}function e_(e){if(e.startsWith("//")){let t=eb("http:"+e);return t.scheme="",t.type=6,t}if(eS(e)){let t=eb("http://foo.com"+e);return t.scheme="",t.host="",t.type=5,t}if(e.startsWith("file:"))return function(e){let t=ew.exec(e),n=t[2];return ex("file:","",t[1]||"","",eS(n)?n:"/"+n,t[3]||"",t[4]||"")}(e);if(eg.test(e))return eb(e);let t=eb("http://foo.com/"+e);return t.scheme="",t.host="",t.type=e?e.startsWith("?")?3:e.startsWith("#")?2:4:1,t}function eO(e,t){let n=t<=4,r=e.path.split("/"),i=1,o=0,s=!1;for(let e=1;e<r.length;e++){let t=r[e];if(!t){s=!0;continue}if(s=!1,"."!==t){if(".."===t){o?(s=!0,o--,i--):n&&(r[i++]=t);continue}r[i++]=t,o++}}let l="";for(let e=1;e<i;e++)l+="/"+r[e];l&&(!s||l.endsWith("/.."))||(l+="/"),e.path=l}function ev(e,t){return t&&!t.endsWith("/")&&(t+="/"),function(e,t){if(!e&&!t)return"";let n=e_(e),r=n.type;if(t&&7!==r){let e=e_(t),i=e.type;switch(r){case 1:n.hash=e.hash;case 2:n.query=e.query;case 3:case 4:eO(e,e.type),"/"===n.path?n.path=e.path:n.path=function(e){if(e.endsWith("/.."))return e;let t=e.lastIndexOf("/");return e.slice(0,t+1)}(e.path)+n.path;case 5:n.user=e.user,n.host=e.host,n.port=e.port;case 6:n.scheme=e.scheme}i>r&&(r=i)}eO(n,r);let i=n.query+n.hash;switch(r){case 2:case 3:return i;case 4:{let r=n.path.slice(1);if(!r)return i||".";if(ez(t||e)&&!ez(r))return"./"+r+i;return r+i}case 5:return n.path+i;default:return n.scheme+"//"+n.user+n.host+n.port+n.path+i}}(e,t)}function eM(e,t){for(let n=t;n<e.length;n++)if(!function(e){for(let t=1;t<e.length;t++)if(e[t][0]<e[t-1][0])return!1;return!0}(e[n]))return n;return e.length}function ek(e,t){return e[0]-t[0]}let e$=!1;function eE(e,t,n){for(let r=n+1;r<e.length&&e[r][0]===t;n=r++);return n}function eC(e,t,n){for(let r=n-1;r>=0&&e[r][0]===t;n=r--);return n}function ej(){return{lastKey:-1,lastNeedle:-1,lastIndex:-1}}function eI(e,t,n,r){let{lastKey:i,lastNeedle:o,lastIndex:s}=n,l=0,u=e.length-1;if(r===i){if(t===o)return e$=-1!==s&&e[s][0]===t,s;t>=o?l=-1===s?0:s:u=s}return n.lastKey=r,n.lastNeedle=t,n.lastIndex=function(e,t,n,r){for(;n<=r;){let i=n+(r-n>>1),o=e[i][0]-t;if(0===o)return e$=!0,i;o<0?n=i+1:r=i-1}return e$=!1,n-1}(e,t,l,u)}function eP(){return{__proto__:null}}const eB=function(e,t){let n=eA(e);if(!("sections"in n))return new eD(n,t);let r=[],i=[],o=[],s=[],l=[];return function e(t,n,r,i,o,s,l,u,a,c,d){let{sections:f}=t;for(let t=0;t<f.length;t++){let{map:p,offset:h}=f[t],m=c,g=d;if(t+1<f.length){let e=f[t+1].offset;(m=Math.min(c,u+e.line))===c?g=Math.min(d,a+e.column):m<c&&(g=a+e.column)}!function(t,n,r,i,o,s,l,u,a,c,d){let f=eA(t);if("sections"in f)return e(...arguments);let p=new eD(f,n),h=i.length,m=s.length,g=eL(p),{resolvedSources:y,sourcesContent:w,ignoreList:S}=p;if(eN(i,y),eN(s,p.names),w)eN(o,w);else for(let e=0;e<y.length;e++)o.push(null);if(S)for(let e=0;e<S.length;e++)l.push(S[e]+h);for(let e=0;e<g.length;e++){let t=u+e;if(t>c)return;let n=function(e,t){for(let n=e.length;n<=t;n++)e[n]=[];return e[t]}(r,t),i=0===e?a:0,o=g[e];for(let e=0;e<o.length;e++){let r=o[e],s=i+r[0];if(t===c&&s>=d)return;if(1===r.length){n.push([s]);continue}let l=h+r[1],u=r[2],a=r[3];n.push(4===r.length?[s,l,u,a]:[s,l,u,a,m+r[4]])}}}(p,n,r,i,o,s,l,u+h.line,a+h.column,m,g)}}(n,t,r,i,o,s,l,0,0,1/0,1/0),function(e,t){var n;let r=new eD((n=[],{version:e.version,file:e.file,names:e.names,sourceRoot:e.sourceRoot,sources:e.sources,sourcesContent:e.sourcesContent,mappings:n,ignoreList:e.ignoreList||e.x_google_ignoreList}),void 0);return r._decoded=e.mappings,r}({version:3,file:n.file,names:s,sources:i,sourcesContent:o,mappings:r,ignoreList:l})};function eA(e){return"string"==typeof e?JSON.parse(e):e}function eN(e,t){for(let n=0;n<t.length;n++)e.push(t[n])}const eR="`line` must be greater than 0 (lines start at line 1)",eT="`column` must be greater than or equal to 0 (columns start at column 0)";class eD{constructor(e,t){let n="string"==typeof e;if(!n&&e._decodedMemo)return e;let r=n?JSON.parse(e):e,{version:i,file:o,names:s,sourceRoot:l,sources:u,sourcesContent:a}=r;this.version=i,this.file=o,this.names=s||[],this.sourceRoot=l,this.sources=u,this.sourcesContent=a,this.ignoreList=r.ignoreList||r.x_google_ignoreList||void 0;let c=ev(l||"",function(e){if(!e)return"";let t=e.lastIndexOf("/");return e.slice(0,t+1)}(t));this.resolvedSources=u.map(e=>ev(e||"",c));let{mappings:d}=r;"string"==typeof d?(this._encoded=d,this._decoded=void 0):(this._encoded=void 0,this._decoded=function(e,t){let n=eM(e,0);if(n===e.length)return e;t||(e=e.slice());for(let i=n;i<e.length;i=eM(e,i+1)){var r;e[i]=(r=e[i],t||(r=r.slice()),r.sort(ek))}return e}(d,n)),this._decodedMemo=ej(),this._bySources=void 0,this._bySourceMemos=void 0}}function eL(e){return e._decoded||(e._decoded=function(e){let t=new Int32Array(5),n=[],r=0;do{let i=function(e,t){let n=e.indexOf(";",t);return -1===n?e.length:n}(e,r),o=[],s=!0,l=0;t[0]=0;for(let n=r;n<i;n++){let r;n=ef(e,n,t,0);let u=t[0];u<l&&(s=!1),l=u,ep(e,n,i)?(n=ef(e,n,t,1),n=ef(e,n,t,2),n=ef(e,n,t,3),ep(e,n,i)?(n=ef(e,n,t,4),r=[u,t[1],t[2],t[3],t[4]]):r=[u,t[1],t[2],t[3]]):r=[u],o.push(r)}s||function(e){e.sort(eh)}(o),n.push(o),r=i+1}while(r<=e.length);return n}(e._encoded))}function eF(e,t,n,r){return{source:e,line:t,column:n,name:r}}function eq(e,t){return{line:e,column:t}}function eU(e,t,n,r,i){let o=eI(e,r,t,n);return(e$?o=(-1===i?eE:eC)(e,r,o):-1===i&&o++,-1===o||o===e.length)?-1:o}function eW(e,t,n,r,i,o){if(--n<0)throw Error(eR);if(r<0)throw Error(eT);let{sources:s,resolvedSources:l}=e,u=s.indexOf(t);if(-1===u&&(u=l.indexOf(t)),-1===u)return o?[]:eq(null,null);let a=(e._bySources||(e._bySources=function(e,t){let n=t.map(eP);for(let r=0;r<e.length;r++){let i=e[r];for(let e=0;e<i.length;e++){let o=i[e];if(1===o.length)continue;let s=o[1],l=o[2],u=o[3],a=n[s],c=a[l]||(a[l]=[]),d=t[s],f=eE(c,u,eI(c,u,d,l));d.lastIndex=++f,function(e,t,n){for(let n=e.length;n>t;n--)e[n]=e[n-1];e[t]=n}(c,f,[u,r,o[0]])}}return n}(eL(e),e._bySourceMemos=s.map(ej))))[u][n];if(null==a)return o?[]:eq(null,null);let c=e._bySourceMemos[u];if(o)return function(e,t,n,r,i){let o=eU(e,t,n,r,1);if(!e$&&-1===i&&o++,-1===o||o===e.length)return[];let s=e$?r:e[o][0];e$||(o=eC(e,s,o));let l=eE(e,s,o),u=[];for(;o<=l;o++){let t=e[o];u.push(eq(t[1]+1,t[2]))}return u}(a,c,n,r,i);let d=eU(a,c,n,r,i);if(-1===d)return eq(null,null);let f=a[d];return eq(f[1]+1,f[2])}class eG{constructor(e,t){let n=this._map=new eB(e,t);this.file=n.file,this.names=n.names,this.sourceRoot=n.sourceRoot,this.sources=n.resolvedSources,this.sourcesContent=n.sourcesContent,this.version=n.version}static fromSourceMap(e,t){return e.toDecodedMap?new eG(e.toDecodedMap(),t):new eG(e.toJSON(),t)}get mappings(){var e,t;return null!==(t=(e=this._map)._encoded)&&void 0!==t?t:e._encoded=function(e){let t=new Int32Array(5),n=new Uint8Array(16384),r=n.subarray(0,16348),i=0,o="";for(let s=0;s<e.length;s++){let l=e[s];if(s>0&&(16384===i&&(o+=ed.decode(n),i=0),n[i++]=59),0!==l.length){t[0]=0;for(let e=0;e<l.length;e++){let s=l[e];i>16348&&(o+=ed.decode(r),n.copyWithin(0,16348,i),i-=16348),e>0&&(n[i++]=44),i=em(n,i,t,s,0),1!==s.length&&(i=em(n,i,t,s,1),i=em(n,i,t,s,2),i=em(n,i,t,s,3),4!==s.length&&(i=em(n,i,t,s,4)))}}}return o+ed.decode(n.subarray(0,i))}(e._decoded)}originalPositionFor(e){return function(e,t){let{line:n,column:r,bias:i}=t;if(--n<0)throw Error(eR);if(r<0)throw Error(eT);let o=eL(e);if(n>=o.length)return eF(null,null,null,null);let s=o[n],l=eU(s,e._decodedMemo,n,r,i||1);if(-1===l)return eF(null,null,null,null);let u=s[l];if(1===u.length)return eF(null,null,null,null);let{names:a,resolvedSources:c}=e;return eF(c[u[1]],u[2]+1,u[3],5===u.length?a[u[4]]:null)}(this._map,e)}generatedPositionFor(e){return function(e,t){let{source:n,line:r,column:i,bias:o}=t;return eW(e,n,r,i,o||1,!1)}(this._map,e)}allGeneratedPositionsFor(e){return function(e,t){let{source:n,line:r,column:i,bias:o}=t;return eW(e,n,r,i,o||-1,!0)}(this._map,e)}hasContentsOfAllSources(){if(!this.sourcesContent||this.sourcesContent.length!==this.sources.length)return!1;for(let e of this.sourcesContent)if(null==e)return!1;return!0}sourceContentFor(e,t){let n=function(e,t){let{sourcesContent:n}=e;if(null==n)return null;let r=function(e,t){let{sources:n,resolvedSources:r}=e,i=n.indexOf(t);return -1===i&&(i=r.indexOf(t)),i}(e,t);return -1===r?null:n[r]}(this._map,e);if(null!=n)return n;if(t)return null;throw Error(`"${e}" is not in the SourceMap.`)}eachMapping(e,t){!function(e,t){let n=eL(e),{names:r,resolvedSources:i}=e;for(let e=0;e<n.length;e++){let o=n[e];for(let n=0;n<o.length;n++){let s=o[n],l=e+1,u=s[0],a=null,c=null,d=null,f=null;1!==s.length&&(a=i[s[1]],c=s[2]+1,d=s[3]),5===s.length&&(f=r[s[4]]),t({generatedLine:l,generatedColumn:u,source:a,originalLine:c,originalColumn:d,name:f})}}}(this._map,t?e.bind(t):e)}destroy(){}}class eJ extends eG{constructor(e){super(JSON.parse(e),"")}}const eH=new TextDecoder,eK=[".mjs",".js",".cjs",".ts",".tsx",".vue",".svelte",".md",".mdx"],eY=process.cwd();function eZ(e,t=eY){let r=function(e,t=eY){return(e=Z(e)).replace(t,"").replace(/\0/,"")}(e,t);return n.isAbsolute(r)?r.replace("/",""):r}class eV{originalId;filename;label;parsedSize;mapSize;statSize;gzipSize;source;stats;imports;isAsset;isEntry;constructor(e){this.originalId=e,this.filename=e,this.label=e,this.parsedSize=0,this.statSize=0,this.gzipSize=0,this.mapSize=0,this.source=[],this.stats=[],this.imports=new Set,this.isAsset=!0,this.isEntry=!1}addImports(...e){e.forEach(e=>this.imports.add(e))}async setup(e,t,r,i){let{imports:o,dynamicImports:s,map:l,moduleIds:u}=e;this.addImports(...o,...s),this.mapSize=l.length,this.isEntry=e.isEntry;let a=u.length?u.reduce((e,r)=>{let i=t.getModuleInfo(r);return i&&i.code&&(eK.includes(n.extname(i.id))||i.id.startsWith("\0"))&&e.push({id:i.id,code:i.code}),e},[]):function(e){let t=new eJ(e),n=t.sources.reduce((e,n)=>{if(n){let r=t.sourceContentFor(n,!0);r&&e.push({id:n,code:r})}return e},[]);return t.destroy(),n}(l),c=new el({meta:{statSize:0}}),d=new el({kind:"source",meta:{gzipSize:0,parsedSize:0}});for(let e of a){if("."===e.id[0]){let n=await t.resolve(e.id,this.originalId);if(!n)continue;e.id=n.id}let n=V(e.code).byteLength;this.statSize+=n,c.insert(eZ(e.id,i),{kind:"stat",meta:{statSize:n}})}Q("Start analyze stats: module '"+this.originalId+"' find "+a.length+" modules");let f=function(e,t,n){let r=new eJ(t),i={},o=1,s=0,l=eH.decode(e);for(let e=0;e<l.length;e++,s++){let{source:t}=r.originalPositionFor({line:o,column:s});if(null!=t){let r=n(t),o=l[e];r in i||(i[r]=""),i[r]+=o}"\n"===l[e]&&(o+=1,s=-1)}return r.destroy(),i}(e.code,l,e=>{let t=n.relative(i,e);return n.join(i,t)}),p=0;for(let e in f){if(!eK.includes(n.extname(e)))continue;let t=V(f[e]),{byteLength:o}=await r(t),s=t.byteLength;d.insert(eZ(e,i),{kind:"source",meta:{gzipSize:o,parsedSize:s}}),p++}for(let e of(Q("Start analyze source: module '"+this.originalId+"' find "+p+" chunks"),c.mergePrefixSingleDirectory(),c.walk(c.root,(e,t)=>t.groups.push(e)),d.mergePrefixSingleDirectory(),d.walk(d.root,(e,t)=>t.groups.push(e)),this.stats=c.root.groups,this.source=d.root.groups,this.source))this.gzipSize+=e.gzipSize,this.parsedSize+=e.parsedSize}}class eX{compress;modules;workspaceRoot;pluginContext;chunks;constructor(e){this.compress=function(e={}){return e=Object.assign(H,e),t=>J(t,e)}(e),this.modules=[],this.pluginContext=null,this.chunks={},this.workspaceRoot=process.cwd()}installPluginContext(e){this.pluginContext||(this.pluginContext=e)}setupRollupChunks(e){this.chunks=e}async addModule(e,t){let n=function(e,t,n){let r={},i="chunk"===e.type;return r.code=V(i?e.code:e.source),r.map=function(e,t,n){if(t in n)return n[t].source;throw Error(`[analyzer error]: Missing sourcemap for ${e}.`)}(e.fileName,n,t),r.imports=i?e.imports:[],r.dynamicImports=i?e.dynamicImports:[],r.moduleIds=i?e.moduleIds:[],r.filename=e.fileName,r.isEntry=!!i&&e.isEntry,r}(e,this.chunks,t),r=new eV(n.filename);await r.setup(n,this.pluginContext,this.compress,this.workspaceRoot),this.modules.push(r)}processModule(){return this.modules.map(e=>{let{originalId:t,imports:n,...r}=e;return{...r,imports:[...n]}})}}const eQ=!!process.env.CI,e0={analyzerMode:"server",defaultSizes:"stat",summary:!0},e1=e=>U.dim(U.bold(e+"")),e2=e=>e1(function(e){if(!e)return"0 Bytes";let t=parseInt(`${Math.floor(Math.log(e)/Math.log(1024))}`);return(e/(1<<10*t)).toFixed(2)+" "+["Bytes","KB","MB","GB","TB"][t]}(e)),e3=e=>{let t=e.length,n=e.reduce((e,t)=>(e.gzip+=t.gzipSize,e.parsed+=t.parsedSize,e.map+=t.mapSize,e),{gzip:0,parsed:0,map:0}),r=[n.gzip&&`gzip: ${e2(n.gzip)}`,n.map&&`map: ${e2(n.map)}`].filter(Boolean).join(" | ");return`${e1(t)} chunks of ${e2(n.parsed)} ${r?`(${r})`:""}`};function e4(e){let t,s,l;let{reportTitle:u="vite-bundle-analyzer"}=e={...e0,...e},a=new eX(e?.gzipOptions),c={previousSourcemapOption:!1,hasSetSourcemapOption:!1,analyzerModule:a},d=process.cwd(),f=!0,p=process.cwd(),h="server"===e.analyzerMode||"static"===e.analyzerMode,m="json"===e.analyzerMode||"static"===e.analyzerMode,g=(l=!1,{rs:new o.Readable,into(e){l||(this.rs.push(e),this.rs.push(null),s||(s=V(e)),l=!0)},refresh(){l=!1,this.rs=new o.Readable,this.into(s)}});return{name:"vite-bundle-anlyzer",apply:"build",enforce:"post",api:{store:c},configResolved(r){if(d=n.resolve(r.root,r.build.outDir??""),t=r.logger,p=eo(r.root),a.workspaceRoot=p,e.summary){let e=r.plugins.find(e=>"vite:reporter"===e.name);if(f=!!e?.writeBundle,e?.writeBundle){let n="function"==typeof e.writeBundle?e.writeBundle:e.writeBundle?.handler,r=async function(...e){await n?.apply(this,e),t.info(e3(a.modules))};"function"!=typeof e.writeBundle?e.writeBundle.handler=r:e.writeBundle=r}}c.hasSetSourcemapOption||(c.hasSetSourcemapOption=!0,r.build?.sourcemap&&(c.previousSourcemapOption="boolean"==typeof r.build.sourcemap?r.build.sourcemap:"hidden"===r.build.sourcemap),"boolean"==typeof r.build.sourcemap&&r.build.sourcemap?r.build.sourcemap=!0:r.build.sourcemap="hidden",Q("Sourcemap option is set to '"+r.build.sourcemap+"'"))},async generateBundle(e,t){for(let e in a.installPluginContext(this),a.setupRollupChunks(t),t){let r=t[e],[i,o]=function(e,t){let{type:r}=e;if("asset"===r&&".js"===n.extname(e.fileName)){let n=e.fileName+".map";return n in t?[!0,n]:[!0,null]}let i="chunk"===r;return[i,i?e.sourcemapFileName:null]}(r,t),s=!!o;Q("Processing chunk '"+r.fileName+"'.Chunk status: "+i+". Sourcemap status: "+s+"."),i&&o&&await a.addModule(r,o),!c.previousSourcemapOption&&i&&o&&Reflect.deleteProperty(t,o)}},async closeBundle(){e.summary&&!f&&t.info(e3(a.modules)),Q("Finish analyze bundle."+a.modules.length+" chunks found.");let o=a.processModule();if(m){let t="fileName"in e?e.fileName:"stats",r=n.join(d,`${t}.${"json"===e.analyzerMode?"json":"html"}`);if("json"===e.analyzerMode)return W.writeFile(r,JSON.stringify(o,null,2),"utf8");let i=await et(o,{title:u,mode:e.defaultSizes||"stat"});if(W.writeFile(r,i,"utf8"),g.into(i),"static"===e.analyzerMode&&!e.openAnalyzer)return}if(h){let t=await et(o,{title:u,mode:e.defaultSizes||"stat"});g.into(t);let{setup:n,port:s}=await er("analyzerPort"in e?"auto"===e.analyzerPort?0:e.analyzerPort:8888);n({title:u,mode:"stat",arena:g}),"openAnalyzer"in e&&!e.openAnalyzer||eQ||function(e){let[t,n]=function(e){switch(e){case"linux":if(-1!==r.release().toLocaleLowerCase().indexOf("microsoft"))return["win32","cmd.exe"];return["linux","xdg-open"];case"win32":return["win32","cmd.exe"];case"darwin":return["darwin","open"];default:return[e,"xdg-open"]}}(r.platform());"win32"===t&&(e=["/c","start",'""'].concat(e=e.map(e=>e.replace(/[&^]/g,"^$&")))),i.spawn(n,e)}([`http://localhost:${s}`]);return}throw Error("Invalidate Option `analyzerMode`")}}}exports.adapter=function(e){let t=["name","generateBundle","closeBundle","api"].reduce((t,n)=>(t[n]=e[n],t),{}),n=process.cwd(),{store:r}=t.api;return{...t,outputOptions(e){if(!r.hasSetSourcemapOption)return e.dir&&(n=e.dir),r.analyzerModule.workspaceRoot=eo(n),"sourcemap"in e&&(r.previousSourcemapOption="boolean"==typeof e.sourcemap?e.sourcemap:"hidden"===e.sourcemap),"boolean"==typeof e.sourcemap&&e.sourcemap?e.sourcemap=!0:e.sourcemap="hidden",e}}},exports.analyzer=e4,exports.default=e4;
